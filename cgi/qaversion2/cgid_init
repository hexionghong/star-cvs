#! /opt/star/bin/perl

# cgid_init
#
# BEN(6jul00):  cgid_init makes sure cgid and ssh port frowarding from the web
# server are working on rcas6001.  It should be run from a cron job.

use strict;

my $qaPath = "/afs/rhic/star/packages/dev/cgi/qaversion2";
my $webServer = "sol.star.bnl.gov";
my $loopCode = "while cd; do sleep 1000; done";

# check for cgid running
my $running = `ps -u starlib | grep cgid`;
if (! $running){
    my $result = `$qaPath/cgid &`;
    print $result;
}

# check for ssh running
$running = `ps -fu root | grep ssh | grep 8080`; # forked to run as root
if (! $running){
    my $result = `ssh -f -R 8080:localhost:8080 $webServer "loopCode"`; 
    print $result;
}

exit 0;
