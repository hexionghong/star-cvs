#!gnumake

Doc : src/msgPublic.c  src/msgFortran.c src/msgBackCom.c src/msgPrivate.c
#	cd doc; docc  ../src/msgPublic.c;    mv buttons.html msgPublic.html    ; cd ..
#	cd doc; docc  ../src/msgFortran.c;   mv buttons.html msgFortran.html   ; cd ..
#	cd doc; docc  ../src/msgBackCom.c;   mv buttons.html msgBackCom.html   ; cd ..
#	cd doc; docc  ../src/msgPrivate.c;   mv buttons.html msgPrivate.html   ; cd ..
	cd doc; docc  ../src/msgPublic.c;    mv buttons.html msgPublic.html    ; cd ..
	cd doc; docc  ../src/msgFortran.c;   mv buttons.html msgFortran.html   ; cd ..
	cd doc; docc  ../src/msgBackCom.c;   mv buttons.html msgBackCom.html   ; cd ..
	cd doc; docc  ../src/msgPrivate.c;   mv buttons.html msgPrivate.html   ; cd ..

FF         = f77
FFLAGS     = -c -O -w -extend_source

# Note:  "msg" is a Tcl/Tk gui.
Run : msg msgControl rmid
	chmod u+x msg

Test : msgTest msgtest msgctest msgstest msgstest_so msgControl msgTest.ref msgtest.ref msgctest.ref
#	Automated test -- if any differences are found from the reference journals, the
#	                  offending lines will be displayed and gnumake will stop, with an error.

	cd wrk

	msgTest 2> /dev/null
	diff -I"Elapsed:" -I"--- Message Accounting Summary" -I"--- CPU Usage Summary ---" -I"msgTest-O4  Once    #4" msg.jou msgTest.ref
	rm msg.jou

	msgtest 2> /dev/null
	diff -I"Elapsed:" -I"--- Message Accounting Summary" -I"--- CPU Usage Summary ---" -I"msgTest-O4  Once    #4" msg.jou msgtest.ref
	rm msg.jou

	msgctest 2> /dev/null
	diff -I"Elapsed:" -I"--- Message Accounting Summary" -I"--- CPU Usage Summary ---" -I"msgTest-O4  Once    #4" msg.jou msgctest.ref
	rm msg.jou

#	msgstest &
#	msgstest_so &
#	msg &


#	General test, no back-compatibility nor Fortran interface:
msgTest : srcm/msgTest.o $(LIBDIR)/libmsg.a
	cd srcm
	$(CC) $^ -lc -o $@
	cd ..

#	Fortran interface test, including back-compatibility interface:
msgtest : srcm/msgtest.o $(LIBDIR)/libmsg.a
	cd srcm
	$(FF) $^ -o $@
	cd ..

#	No Fortran, but back-compatibility interface test:
msgctest : srcm/msgctest.o $(LIBDIR)/libmsg.a
	cd srcm
	$(CC) $^ -lc -lftn -o $@
	cd ..

#	Shared memory (control with msgControl) test:
msgstest : srcm/msgstest.o msgControl $(LIBDIR)/libmsg.a
	cd srcm
	$(FF) msgstest.o $(LIBDIR)/libmsg.a -o msgstest
	cd ..

#	Shared memory (control with msgControl) test, using the msg shared object library:
msgstest_so : srcm/msgstest.o msgControl $(LIBDIR)/libmsg.so
	cd srcm
	$(FF) msgstest.o $(LIBDIR)/libmsg.so -o msgstest_so
	cd ..

#	This picks up the msg routines in a run-time hookup with a specified msg-link executatble:
#	  (Hence, no msg library specified here.)
#msgControl : msgControl.o
#	$(CC) msgControl.o -lc -o msgControl
msgControl : srcm/msgControl.o $(LIBDIR)/libmsg.a
	cd srcm
	$(CC) $^ -lc -lftn -o $@
	cd ..
