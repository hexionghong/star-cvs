.PHONY: config
#
include $(SLM_DIR)/constants.mk
include Makefile.control
#
BASE_DIR := $(shell pwd)
BASE_NAME := $(notdir $(BASE_DIR))
BASE_ROOT := $(dir $(BASE_DIR))
#
ifneq ($(filter $(BASE_NAME),$(ASPS)),$(EMPTY))
PKGTYPE := ASP
ASP := $(BASE_NAME)
PAM := $(EMPTY)
else
ASP := $(EMPTY)
endif
ifneq ($(filter $(BASE_NAME),$(PAMS)),$(EMPTY))
PKGTYPE := PAM
ASP := $(EMPTY)
PAM := $(BASE_NAME)
else
PAM := $(EMPTY)
endif
ASPLIBS := $(addprefix -l,$(ASPS))
PAMLIBS := $(addprefix -l,$(PAMS))
USRLIBS := $(USER_LIBS)
#
MODULES := $(CVSROOT)/CVSROOT/modules
BRANCH_NAME := $(shell awk '$$1=="$(BASE_NAME)" {print $$2}' $(MODULES))
BRANCH_NAME := $(subst /, ,$(BRANCH_NAME))
BRANCH_NAME := $(word 2,$(BRANCH_NAME))
BRANCH_DIRS := \
	$(STAR_LIB)/$(STAR_PHY_LEVEL)/phy/ \
	$(STAR_LIB)/$(STAR_ANA_LEVEL)/ana/ \
	$(STAR_LIB)/$(STAR_SIM_LEVEL)/sim/ \
	$(STAR_LIB)/$(STAR_SYS_LEVEL)/sys/
BINDIR := $(BASE_DIR)/bin/$(STAR_ARCH)
BINROOT := $(dir $(BINDIR))
CDFDIR := $(BASE_DIR)/cdf
DOCDIR := $(BASE_DIR)/doc
IDLDIR := $(BASE_DIR)/idl
IDLDIRS += $(IDLDIR)
IDLDIRS += $(addsuffix inc/,$(BRANCH_DIRS))
INCDIR := $(BASE_DIR)/inc
INCDIRS += $(INCDIR)
INCDIRS += $(addsuffix inc/,$(BRANCH_DIRS))
LIBDIR := $(BASE_DIR)/lib/$(STAR_ARCH)
LIBDIRS += $(LIBDIR)
ifeq ($(SHARE),$(TRUE))
LIBLIB += solib/
else
LIBLIB += lib/
endif
LIBDIRS += $(addsuffix $(LIBLIB),$(BRANCH_DIRS))
LIBROOT := $(dir $(LIBDIR))
SOLIBDIR := $(BASE_DIR)/solib/$(STAR_ARCH)
SRCDIR := $(BASE_DIR)/src
SRCMDIR := $(BASE_DIR)/srcm
WRKDIR := $(BASE_DIR)/wrk
#
SUBDIRS += bin cdf doc idl inc lib src srcm wrk
SUBMAKES := $(addsuffix /Makefile,$(SUBDIRS))
#
config: $(BASE_DIR)/$(BASE_NAME).config
#
$(BASE_DIR)/$(BASE_NAME).config: $(BASE_DIR)/Makefile.control
	-rm $@
	@echo "###############################################"	>  $@
	@echo "#" $@						>> $@
	@echo "# Automatically generated by make config from:"	>> $@
	@echo "#" $^						>> $@
	@echo "# DO NOT EDIT THIS FILE"				>> $@
	@echo ""						>> $@
	@echo "include $$(SLM_DIR)/constants.mk"		>> $@
	@echo ""						>> $@
	@echo "export BASE_ROOT :=" $(BASE_ROOT)		>> $@
	@echo "export BASE_DIR :=" $(BASE_DIR)			>> $@
	@echo "export BASE_NAME :=" $(BASE_NAME)		>> $@
	@echo ""						>> $@
	@echo "export BRANCH_NAME :=" $(BRANCH_NAME)		>> $@
	@echo "export PKGTYPE :=" $(PKGTYPE)			>> $@
	@echo ""						>> $@
	@echo "export ASP :=" $(ASP)				>> $@
	@echo "export PAM :=" $(PAM)				>> $@
	@echo "export ASPS :=" $(ASPS)				>> $@
	@echo "export PAMS :=" $(PAMS)				>> $@
	@echo "export ASPLIBS :=" $(ASPLIBS)			>> $@
	@echo "export PAMLIBS :=" $(PAMLIBS)			>> $@
	@echo "export USRLIBS :=" $(USRLIBS)			>> $@
	@echo ""						>> $@
	@echo "export BINDIR :=" $(BINDIR)			>> $@
	@echo "export CDFDIR :=" $(CDFDIR)			>> $@
	@echo "export DOCDIR :=" $(DOCDIR)			>> $@
	@echo "export IDLDIR :=" $(IDLDIR)			>> $@
	@echo "export IDLDIRS :=" $(IDLDIRS)			>> $@
	@echo "export INCDIR :=" $(INCDIR)			>> $@
	@echo "export INCDIRS :=" $(INCDIRS)			>> $@
	@echo "export LIBDIR :=" $(LIBDIR)			>> $@
	@echo "export LIBDIRS :=" $(LIBDIRS)			>> $@
	@echo "export SOLIBDIR :=" $(SOLIBDIR)			>> $@
	@echo "export SRCDIR :=" $(SRCDIR)			>> $@
	@echo "export SRCMDIR :=" $(SRCMDIR)			>> $@
	@echo "export WRKDIR :=" $(WRKDIR)			>> $@
	@echo ""						>> $@
	@echo "export SUBDIRS :="				>> $@
	@echo "export SUBMAKES :="				>> $@
	@echo ""						>> $@
	@echo "export DEBUG :=" $(DEBUG)			>> $@
	@echo "export SHARE :=" $(SHARE)			>> $@
	@echo "export MOTIF :=" $(MOTIF)			>> $@
	@echo ""						>> $@
	@echo "export USER_LIBS :=" $(USER_LIBS)		>> $@
	@echo ""						>> $@
	@echo "export CERNLIBS :=" $(CERNLIBS)		        >> $@
	@echo ""						>> $@
	@echo "export INSTALL_BIN_FILES :=" $(INSTALL_BIN_FILES)>> $@
	@echo ""						>> $@
#
