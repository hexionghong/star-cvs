#!/bin/csh
#
if ( $#argv < 2 ) then
	echo " "
	echo Usage: $0 pkg file "[ ... ]"
	echo Example:
	echo '	'$0' xxx ../idl/*.idl'
	echo " "
	exit
endif
#
set pkg = $1
set pidls = ` egrep -l 'interface.*:.*amiModule' ../idl/*.idl `
#
echo '/* automatically generated file -- DO NOT EDIT */'
foreach p ($pidls)
	set h = `echo $p | sed -e 's/.*\///' -e 's/idl$/h/'`
	echo '#include "'$h'"'
end
echo 'extern "C" int'" ${pkg}_init(void), ${pkg}_start(void), ${pkg}_stop(void);"
echo "int ${pkg}_init() { return 1; }"
echo "int ${pkg}_start() {"
foreach p ($pidls)
	set pams = ` egrep -h 'interface.*:.*amiModule' $p | sed -e 's/:.*//' -e 's/.*interface[ 	]//' `
	foreach pp ($pams)
		echo "	${pp}_load_ami(ami);"
	end
end
echo 'return 1; }'
echo "int ${pkg}_stop() { return 1; }"
#
