<HTML>
<PRE>
<H2>file: spx/src/spxClasses.cc</H2>


//:Copyright 1995, Lawrence Berkeley National Laboratory
//:&gt;--------------------------------------------------------------------
//:FILE:        spxClasses.C
//:DESCRIPTION: Implementation classes for <A HREF="spx_macros.h.html#SPX">SPX</A>.
//:AUTHOR:      cet - Craig E. Tull, cetull@lbl.gov
//:BUGS:        -- STILL IN DEVELOPMENT --
//:HISTORY:     25oct95-v000a-cet- creation
//:&lt;--------------------------------------------------------------------

//:----------------------------------------------- INCLUDES           --
#include &lt;stream.h&gt;
#include &lt;string.h&gt;
#include &lt;time.h&gt;

#include "asuAlloc.h"
#include "asuLib.h"
#include "emlLib.h"
#include "socLib.h"
#include "<A HREF="spxClasses.hh.html">spxClasses.hh</A>"

//:&lt;---------------------------------------------- MACROS             --
#include "<A HREF="spx_macros.h.html">spx_macros.h</A>"

//:=============================================== CLASS              ==
//: spxDummy

//:----------------------------------------------- CTORS & DTOR       --
<B>spxDummy:: <A NAME="spxDummy">spxDummy(</A>const char* name) </B>
	: socObject(name, "spxDummy") {
   myPtr = (SOC_PTR_T)this;
   myNCalls = 0;
}

//----------------------------------
<B>spxDummy:: ~<A NAME="spxDummy">spxDummy(</A>) {</B>
}

//:----------------------------------------------- ATTRIBUTES         --
<B>long spxDummy::  <A NAME="nCalls">nCalls</A> () {</B>
   myNCalls++;
   return myNCalls;
}

//:----------------------------------------------- PUB FUNCTIONS      --
<B>STAFCV_T spxDummy:: <A NAME="hello">hello</A> (const char * message) {</B>
   myNCalls++;
   printf(" %s \n",message);
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxDummy:: <A NAME="null">null</A> () {</B>
   myNCalls++;
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxDummy:: <A NAME="getTime">getTime</A> (char *& tim) {</B>
   myNCalls++;
   time_t it = time(0);
   char* c=NULL;
   c = (char*)ASUALLOC(strlen(ctime(&it)) +1);
   strcpy(c,ctime(&it));
   tim = (char *)c;
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//:----------------------------------------------- PRIV FUNCTIONS     --
//:**NONE**

//:=============================================== CLASS              ==
//: spxGrid

//:----------------------------------------------- CTORS & DTOR       --
<B>spxGrid:: <A NAME="spxGrid">spxGrid(</A>const char* name, const short h, const short w) </B>
	: socObject(name, "spxGrid") {
   myPtr = (SOC_PTR_T)this;
   myHeight = h;
   myWidth = w;
   myGrid = new long* [h];
   for( int i=0;i&lt;h;i++ ){
      myGrid[i] = new long[w];
   }
}

//----------------------------------
<B>spxGrid:: ~<A NAME="spxGrid">spxGrid(</A>) {</B>
   for( int i=0;i&lt;myHeight;i++ ){
      delete[] myGrid[i];
   }
   delete[] myGrid;
}

//:----------------------------------------------- ATTRIBUTES         --
<B>short spxGrid::  <A NAME="height">height</A> () {</B>
   return myHeight;
}

//----------------------------------
<B>short spxGrid::  <A NAME="width">width</A> () {</B>
   return myWidth;
}

//:----------------------------------------------- PUB FUNCTIONS      --
<B>STAFCV_T spxGrid:: <A NAME="get">get</A> (short n, short m, long& value) {</B>
   if(n&lt;0||n&gt;myHeight||m&lt;0||m&gt;myHeight)EML_ERROR(INVALID_GRIDCELL);
   value = myGrid[n][m];
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxGrid:: <A NAME="set">set</A> (short n, short m, long value) {</B>
   if(n&lt;0||n&gt;myHeight||m&lt;0||m&gt;myHeight)EML_ERROR(INVALID_GRIDCELL);
   myGrid[n][m] = value;
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//:----------------------------------------------- PRIV FUNCTIONS     --
//:**NONE**

//:=============================================== CLASS              ==
//: spxManager

//:----------------------------------------------- CTORS & DTOR       --
<B>spxManager:: <A NAME="spxManager">spxManager(</A>const char * name) </B>
		: socFactory()
		, socObject(name,"spxManager") {
   myPtr = (SOC_PTR_T)this;
   lock(TRUE);
}

//----------------------------------
<B>spxManager:: ~<A NAME="spxManager">spxManager(</A>) {</B>
}

//:----------------------------------------------- ATTRIBUTES         --
//**NONE**

//:----------------------------------------------- PUB FUNCTIONS      --
<B>STAFCV_T spxManager:: <A NAME="deleteDummy">deleteDummy</A> (const char * name) {</B>
   IDREF_T id;

   if( !soc-&gt;idObject(name,"spxDummy",id)
   ||  !deleteEntry(id)
   ||  !soc-&gt;deleteID(id)
   ){
      EML_ERROR(CANT_DELETE_OBJECT);
   }
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="deleteGrid">deleteGrid</A> (const char * name) {</B>
   IDREF_T id;

   if( !soc-&gt;idObject(name,"spxGrid",id)
   ||  !deleteEntry(id)
   ||  !soc-&gt;deleteID(id)
   ){
      EML_ERROR(CANT_DELETE_OBJECT);
   }
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="findDummy">findDummy</A> (const char * name</B>
		, spxDummy*& dummy) {
   socObject* obj;
   if( !soc-&gt;findObject(name,"spxDummy",obj) ){
      dummy = NULL;
      EML_ERROR(OBJECT_NOT_FOUND);
   }
   dummy = (spxDummy*)(obj-&gt;ptr());
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="findGrid">findGrid</A> (const char * name</B>
		, spxGrid*& grid) {
   socObject* obj;
   if( !soc-&gt;findObject(name,"spxGrid",obj) ){
      grid = NULL;
      EML_ERROR(OBJECT_NOT_FOUND);
   }
   grid = (spxGrid*)(obj-&gt;ptr());
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="getDummy">getDummy</A> (IDREF_T id, spxDummy*& dummy) {</B>
   socObject* obj;
   if( !soc-&gt;getObject(id,obj) ){
      dummy = NULL;
      EML_ERROR(OBJECT_NOT_FOUND);
   }
   if( 0 != strcmp(obj-&gt;type(),"spxDummy") ){
      dummy = NULL;
      EML_ERROR(WRONG_OBJECT_TYPE);
   }
   dummy = (spxDummy*)(obj-&gt;ptr());
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="getGrid">getGrid</A> (IDREF_T id, spxGrid*& grid) {</B>
   socObject* obj;
   if( !soc-&gt;getObject(id,obj) ){
      grid = NULL;
      EML_ERROR(OBJECT_NOT_FOUND);
   }
   if( 0 != strcmp(obj-&gt;type(),"spxGrid") ){
      grid = NULL;
      EML_ERROR(WRONG_OBJECT_TYPE);
   }
   grid = (spxGrid*)(obj-&gt;ptr());
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="list">list</A> () {</B>

   socObject* obj;

   printf("\n"
"**********************************************************************"
   "\n"
"**************** <A HREF="spx_macros.h.html#SPX">SPX</A> - Service Package eXample listing ***************"
   "\n"
"**********************************************************************"
   "\n"
"* IDREF * NAME            * TYPE            *                         "
    "\n"
"**********************************************************************"
    "\n");
   for( int i=0;i&lt;myCount;i++ ){
      if( soc-&gt;getObject(entry(i),obj) ){
	 if( 0 == strcmp("spxGrid",obj-&gt;type()) ){
	    printf("* %5d * %-15s * %-15s * Size = (%d,%d) \n"
	    		,obj-&gt;idRef(),obj-&gt;name(),obj-&gt;type()
            		,<A HREF="spx_macros.h.html#SPXGRID">SPXGRID(</A>obj)-&gt;<A HREF="#height">height</A>()
            		,<A HREF="spx_macros.h.html#SPXGRID">SPXGRID(</A>obj)-&gt;<A HREF="#width">width</A>());
	 } else {
	    printf("* %5d * %-15s * %-15s * Calls = %d \n"
	    		,obj-&gt;idRef(),obj-&gt;name(),obj-&gt;type()
            		,<A HREF="spx_macros.h.html#SPXDUMMY">SPXDUMMY(</A>obj)-&gt;<A HREF="#nCalls">nCalls</A>());
	 }
      } else {
         printf("* %5d * %-15s * %-15s * \n"
                        ,entry(i),"**DELETED**","**DELETED**");
      }
   }
   printf(
"**********************************************************************"
   "\n\n");

   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="newDummy">newDummy</A> (const char * name) {</B>
   IDREF_T id;
   if( soc-&gt;idObject(name,"spxDummy",id) ){
      EML_ERROR(DUPLICATE_OBJECT_NAME);
   }
   static spxDummy* p;
   p = new <U>spxDummy(</U>name);        //OVERLOAD CALL: spxDummy: <A HREF="spxClasses.cc.html#spxDummy">spxClasses.cc(?)</A>, <A HREF="spxClasses.cc.html#spxDummy">spxClasses.cc(?)</A>
   if( !soc-&gt;idObject(name,"spxDummy",id) ){
      EML_ERROR(OBJECT_NOT_FOUND);
   }
   addEntry(id);
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//----------------------------------
<B>STAFCV_T spxManager:: <A NAME="newGrid">newGrid</A> (const char * name</B>
		, short <A HREF="#height">height</A>, short <A HREF="#width">width</A>) {
   IDREF_T id;
   if( soc-&gt;idObject(name,"spxGrid",id) ){
      EML_ERROR(DUPLICATE_OBJECT_NAME);
   }
   static spxGrid* p;
   p = new <U>spxGrid(</U>name,<A HREF="#height">height</A>,<A HREF="#width">width</A>);        //OVERLOAD CALL: spxGrid: <A HREF="spxClasses.cc.html#spxGrid">spxClasses.cc(?)</A>, <A HREF="spxClasses.cc.html#spxGrid">spxClasses.cc(?)</A>
   if( !soc-&gt;idObject(name,"spxGrid",id) ){
      EML_ERROR(OBJECT_NOT_FOUND);
   }
   addEntry(id);
   EML_SUCCESS(NORMAL_SUCCESSFUL_COMPLETION);
}

//:----------------------------------------------- PRIV FUNCTIONS     --
//:**NONE**

<P>
<P>
<HR>
<H2>Back to <A HREF="files.html">Source File Index</A></H2><P>
<P><HR>
<H5>C++ to HTML Conversion by <I><A HREF="http://www.usc.edu/dept/robotics/personal/af0a/tools/ctoohtml/ctoohtml.html">ctoohtml</A></I></H5>
















































</PRE>
</HTML>
